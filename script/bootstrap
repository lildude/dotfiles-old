#!/usr/bin/env bash
#
# bootstrap installs things.

DOTFILES=$(cd "$(dirname "$0")/.." && pwd)
# shellcheck source=bin/lib.sh
source "$DOTFILES/bin/lib.sh"
export DEFAULT_SHELL="fish"

create_my_std_dirs() {
  cd "$HOME" || exit 1
  local dirs="bin tmp/trash Development"

  if [ -d "$HOME/Downloads" ]; then
    if [ ! -L "$HOME/tmp" ]; then
      msg="Linked $HOME/Downloads to $HOME/tmp"
      if ln -s Downloads tmp; then success "$msg"; else fail "$msg"; fi
    else
      success "Skipped $HOME/tmp already a symlink"
    fi
  else
    dirs="tmp $dirs"
  fi

  for dir in $dirs; do
    if [ ! -d "$HOME/$dir" ]; then
      msg="Created $HOME/$dir"
      if mkdir "$HOME/$dir"; then success "$msg"; else fail "$msg"; fi
    else
      success "Skipped $HOME/$dir already exists"
    fi
  done
}

info "Bootstrapping to $HOME..."

install_dotfiles
[ $MACOS ] && create_my_std_dirs
info "Installing and updating dependencies..."

# shellcheck source=bin/dot
if source "$DOTFILES/bin/dot" | tee /tmp/dotfiles-dot 2>&1; then
  success "Dependencies installed"
else
  fail "Error installing or updating dependencies"
fi

echo ''
success '  All installed!'
