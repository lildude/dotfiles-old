{"mode":"editor","version":1,"windowDimensions":{"x":34,"y":22,"width":1380,"height":829},"syntax":{"deserializer":"Syntax","grammarOverridesByPath":{}},"project":{"path":"/Users/lildude/tmp/cahoot_freeagent","buffers":[{"text":"#!/usr/bin/env ruby\n\nlib_dir = File.join(File.dirname(__FILE__), '..', 'lib')\n$LOAD_PATH.unshift lib_dir if File.directory?(lib_dir)\n\nrequire 'cahoot_freeagent'\nCahootFreeagent::CLI.start\n","markers":{"markers":{"1":{"id":1,"range":[[0,0],[0,0]],"tailed":false,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":15},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[],"redoStack":[],"deserializer":"History"},"filePath":"/Users/lildude/Downloads/cahoot_freeagent/bin/cahoot_freeagent","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"25563577dd465b27f3b49f2874fa646a0f705f2f","deserializer":"TextBuffer"},{"text":"$:.unshift File.dirname(__FILE__)\n\nrequire 'cahoot_freeagent/cli'\nrequire 'cahoot_freeagent/csv'\n\n\nmodule CahootFreeagent\n\nend\n","markers":{"markers":{"1":{"id":1,"range":[[0,0],[0,0]],"tailed":false,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":22},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[],"redoStack":[],"deserializer":"History"},"filePath":"/Users/lildude/Downloads/cahoot_freeagent/lib/cahoot_freeagent.rb","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"f86dbf0b37152d986c43c46ae07b20af4163bc55","deserializer":"TextBuffer"},{"text":"require 'thor'\nrequire 'cahoot_freeagent/csv'\n\nmodule CahootFreeagent\n  class CLI < Thor\n\n    default_task :parse_html\n\n    desc \"Help\", \"Help text for the command line tool\"\n    def help\n        puts 'This tool parses Cahoot HTML statements to a FreeAgentCentral compatible CSV file'\n        puts 'Download statements from Cahoot and save as HTML files'\n        puts 'Convert the files using the following syntax'\n        puts 'cahoot_freeagent --files statement1.html statement2.html'\n    end\n\n    desc \"Parse HTML\", \"Parses a Cahoot HTML statement and outputs an FreeAgent compatible CSV\"\n    method_options :files => :array\n    def parse_html\n      if options.files?\n        options.files.each do |file|\n          if FileTest.exists?(file)\n            CahootFreeagent::CSV.new(file)\n          else\n            puts \"The file #{file} was not found so was not converted\"\n          end\n        end\n      else\n        puts 'Please specify some files to convert'\n        puts 'USAGE: cahoot_freeagent --files statement.html'\n      end\n    end\n  end\nend\n","markers":{"markers":{"1":{"id":1,"range":[[0,0],[0,0]],"tailed":false,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":30},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[],"redoStack":[],"deserializer":"History"},"filePath":"/Users/lildude/Downloads/cahoot_freeagent/lib/cahoot_freeagent/cli.rb","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"1446b7ae3d41fc06778460e68579bb798a72b8f1","deserializer":"TextBuffer"},{"text":"require 'nokogiri'\nrequire 'time'\nmodule CahootFreeagent\n    class CSV\n      def initialize(html)\n        @target = html.gsub(/html$/, 'csv')\n        parse_html(html)\n        puts html + ' -> ' + @target\n      end\n\n      def parse_html(html)\n        doc = Nokogiri::HTML(open(html))\n        doc.css(\"table.dataTable tr:not(:first-child)\").each do |item|\n          @date = clean_string(item.at_css('td:nth-child(1)'))\n          @description = clean_string(item.at_css('td:nth-child(2)'))\n          withdrawn = clean_string(item.at_css('td:nth-child(3)'))\n          paid_in = clean_string(item.at_css('td:nth-child(4)'))\n          @amount = paid_in.empty?  ? \"-\" + withdrawn : paid_in\n          CSV.open(@target, 'a') do |csv|\n            csv << [format_date(@date),@amount,@description]\n          end\n        end\n      end\n\n      def clean_string(string)\n        string.text.gsub(/\\302\\240/, '').gsub(/Â£/, '')\n      end\n\n      def format_date(date)\n        Time.parse(date).strftime(\"%d/%m/%Y\")\n      end\n\n      def format_description(description)\n        description.gsub(/(.*)/, '\\1')\n      end\n\n    end\n\nend\n","markers":{"markers":{"1":{"id":1,"range":[[15,66],[15,66]],"tailed":false,"reversed":true,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":36,"goalBufferRange":null},"deserializer":"Marker"},"14":{"id":14,"range":[[0,0],[0,18]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{},"deserializer":"Marker"},"15":{"id":15,"range":[[6,0],[6,24]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{},"deserializer":"Marker"},"16":{"id":16,"range":[[18,0],[18,41]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[{"patches":[{"oldRange":[[19,10],[19,16]],"newRange":[[19,10],[19,10]],"oldText":"Faster","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[1,0],[2,0]],"newRange":[[1,0],[1,0]],"oldText":"require 'fastercsv'\n","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[6,24],[6,28]],"newRange":[[6,24],[6,24]],"oldText":"    ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[1,0],[1,0]],"newRange":[[1,0],[1,1]],"oldText":"","newText":"x","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"reversed":false,"range":[[1,1],[1,1]]},"newParams":{"reversed":true,"range":[[1,0],[1,1]]},"deserializer":"MarkerPatch"},{"oldRange":[[1,0],[1,1]],"newRange":[[1,0],[1,0]],"oldText":"x","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"}],"redoStack":[],"deserializer":"History"},"filePath":"/Users/lildude/Downloads/cahoot_freeagent/lib/cahoot_freeagent/csv.rb","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"ec34281d603418e4d793d532f6f9fccfba9bf132","deserializer":"TextBuffer"}],"deserializer":"Project"},"workspace":{"paneContainer":{"root":{"items":[{"id":15,"softTabs":true,"displayBuffer":{"id":16,"softWrap":false,"editorWidthInChars":null,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/lildude/Downloads/cahoot_freeagent/bin/cahoot_freeagent","tabLength":2,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"},{"id":22,"softTabs":true,"displayBuffer":{"id":23,"softWrap":false,"editorWidthInChars":null,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/lildude/Downloads/cahoot_freeagent/lib/cahoot_freeagent.rb","tabLength":2,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"},{"id":30,"softTabs":true,"displayBuffer":{"id":31,"softWrap":false,"editorWidthInChars":null,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/lildude/Downloads/cahoot_freeagent/lib/cahoot_freeagent/cli.rb","tabLength":2,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"},{"id":36,"softTabs":true,"displayBuffer":{"id":37,"softWrap":false,"editorWidthInChars":null,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/lildude/Downloads/cahoot_freeagent/lib/cahoot_freeagent/csv.rb","tabLength":2,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"}],"activeItemUri":"/Users/lildude/Downloads/cahoot_freeagent/lib/cahoot_freeagent/csv.rb","focused":true,"active":true,"deserializer":"Pane"},"deserializer":"PaneContainer"},"fullScreen":false,"deserializer":"Workspace"},"packageStates":{"metrics":{"sessionLength":769057},"fuzzy-finder":{"/Users/lildude/Downloads/cahoot_freeagent/bin/cahoot_freeagent":1407675324201,"/Users/lildude/Downloads/cahoot_freeagent/lib/cahoot_freeagent.rb":1407675331960,"/Users/lildude/Downloads/cahoot_freeagent/lib/cahoot_freeagent/cli.rb":1407675336482,"/Users/lildude/Downloads/cahoot_freeagent/lib/cahoot_freeagent/csv.rb":1407675408245},"keybinding-resolver":{"attached":false},"tree-view":{"directoryExpansionStates":{"bin":{},"lib":{"cahoot_freeagent":{}}},"selectedPath":"/Users/lildude/Downloads/cahoot_freeagent/lib/cahoot_freeagent/csv.rb","hasFocus":false,"attached":true,"scrollLeft":0,"scrollTop":0,"width":200}}}