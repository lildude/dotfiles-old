{"mode":"editor","version":1,"windowDimensions":{"x":54,"y":59,"width":1943,"height":1313,"maximized":false},"grammars":{"deserializer":"GrammarRegistry","grammarOverridesByPath":{}},"project":{"paths":["/Users/lildude/Development/stravistix"],"buffers":[{"text":"/**\n *   MenuModifier is responsible of ...\n */\nfunction MenuModifier(athleteId, highLightStravistiXFeature, appResources) {\n    this.athleteId_ = athleteId;\n    this.appResources_ = appResources;\n    this.highLightStravistiXFeature_ = highLightStravistiXFeature;\n}\n\n/**\n * Define prototype\n */\nMenuModifier.prototype = {\n\n    modify: function modify() {\n\n        // Add kom-map to global navigation\n        var globalNav = $(\".global-nav\");\n        var stravaMenuHtml = \"<li class='drop-down-menu' height='auto'>\";\n\n        var menuStyle = null;\n        var menuIcon;\n\n        if (this.highLightStravistiXFeature_) {\n            menuStyle = \"style='font-size:20px; background-color: #fc4c02; color: white;'\"; //TODO Globalize colors\n            menuIcon = this.appResources_.menuIconBlack;\n        } else {\n            menuStyle = \"style='font-size:20px; background-color: transparent; color: #fc4c02;'\"; //TODO Globalize colors\n            menuIcon = this.appResources_.menuIconOrange;\n        }\n\n        var styleSideRight = 'display: inline; float: right; border-top: 1px solid #DDD; border-left: 1px solid #DDD; width: 50%;';\n        var styleSideLeft = 'border-top: 1px solid #DDD; width: 50%;';\n\n        var twitterTweetLink = \"https://twitter.com/intent/tweet?text=As%20%23strava%20user,%20you%20should%20try%20%23stravistix%20web%20extension%20by%20%40champagnethomas.%20Get%20it%20here%20%20bitly.com/stravistix.%20%23cycling%20%23running%20%23geek\";\n\n        stravaMenuHtml += \"<a href='#' class='selection' \" + menuStyle + \"><img style='vertical-align:middle' src='\" + menuIcon + \"'/></a>\";\n        stravaMenuHtml += \"<ul class='options' height='' style='width: 300px; max-height: 650px !important; overflow:hidden;'>\";\n        stravaMenuHtml += \"<li><a target='_blank' href='\" + this.appResources_.settingsLink + \"'><img style='vertical-align:middle' src='\" + this.appResources_.settingsIcon + \"'/> <span>Common Settings</span></a></li>\";\n        stravaMenuHtml += \"<li><a target='_blank' href='\" + this.appResources_.settingsLink + \"#/healthSettings'><img style='vertical-align:middle' src='\" + this.appResources_.heartIcon + \"'> <span>Health Settings</span></a></li>\";\n        stravaMenuHtml += \"<li><a target='_blank' href='\" + this.appResources_.settingsLink + \"#/zonesSettings'><img style='vertical-align:middle' src='\" + this.appResources_.zonesIcon + \"'> <span>Zones Settings</span></a></li>\";\n        stravaMenuHtml += \"<li><a href='http://labs.strava.com/achievement-map/' target='_blank'><img style='vertical-align:middle' src='\" + this.appResources_.komMapIcon + \"'/> <span>KOM/CR Map</span></a></li>\";\n        stravaMenuHtml += \"<li id='splus_menu_heatmap'><a href='#' target='_blank'><img style='vertical-align:middle' src='\" + this.appResources_.heatmapIcon + \"'/> <span>Heat Map</span></a></li>\";\n        // stravaMenuHtml += \"<li><a href='http://veloviewer.com/athlete/\" + this.athleteId_ + \"/summary' target='_blank'><img style='vertical-align:middle' src='\" + this.appResources_.veloviewerDashboardIcon + \"'/> <span>Dashboard <i>VeloViewer</i></span></a></li>\";\n        // stravaMenuHtml += \"<li><a href='http://veloviewer.com/athlete/\" + this.athleteId_ + \"/challenges' target='_blank'><img style='vertical-align:middle' src='\" + this.appResources_.veloviewerChallengesIcon + \"'/> <span>Strava Challenges <i>VeloViewer</i></span></a></li>\";\n        stravaMenuHtml += \"<li style='border-top: 1px solid #DDD;'><a style='font-style: italic;' href='\" + this.appResources_.settingsLink + \"#/releaseNotes' target='_blank'><img style='vertical-align:middle' src='\" + this.appResources_.systemUpdatesIcon + \"'/> <span><strong>v\" + this.appResources_.extVersion + \"</strong> release notes</span></a></li>\";\n\n        stravaMenuHtml += \"<li style='\" + styleSideRight + \"'><a style='font-style: italic;' href='https://chrome.google.com/webstore/detail/stravistix/dhiaggccakkgdfcadnklkbljcgicpckn/reviews' target='_blank'><img style='vertical-align:middle' src='\" + this.appResources_.rateIcon + \"'/> <span>Rate</span></a></li>\";\n        stravaMenuHtml += \"<li style='\" + styleSideLeft + \"' ><a  style='font-style: italic;' href='https://twitter.com/champagnethomas' style='font-style: italic;' target='_blank'><img style='vertical-align:middle' src='\" + this.appResources_.twitterIcon + \"'/> <span>What's next?</span></a></li>\";\n\n        stravaMenuHtml += \"<li style='\" + styleSideRight + \"'><a style='font-style: italic;' href='\" + this.appResources_.settingsLink + \"#/donate' target='_blank'><img style='vertical-align:middle' src='\" + this.appResources_.donateIcon + \"'/> <span>Donate</span></a></li>\";\n        stravaMenuHtml += \"<li style='\" + styleSideLeft + \"'><a style='font-style: italic;' href='http://thomaschampagne.github.io/' target='_blank'><img style='vertical-align:middle' src='\" + this.appResources_.bikeIcon + \"'/> <span> Author site</span></a></li>\";\n        stravaMenuHtml += \"<li style='border-top: 1px solid #DDD;'><a target='_blank' href='\" + twitterTweetLink + \"'><img style='vertical-align:middle' src='\" + this.appResources_.shareIcon + \"'/> <span>Share this extension</span></a></li>\";\n        stravaMenuHtml += \"</ul>\";\n        stravaMenuHtml += \"</li>\";\n\n        // TODO Move geolocation permission ask out ?\n        if (navigator.geolocation) {\n            navigator.geolocation.getCurrentPosition(\n                function(position) {\n                    $('#splus_menu_heatmap').find('a').attr('href', 'http://labs.strava.com/heatmap/#12/' + position.coords.longitude + '/' + position.coords.latitude + '/gray/both');\n                },\n                function(error) {\n                    if (error != null) {\n                        $('#splus_menu_heatmap').find('a').attr('href', '#');\n                        $('#splus_menu_heatmap').find('a').attr('target', '_self');\n                        $('#splus_menu_heatmap').find('a').attr('onclick', 'alert(\"Some StravistiX functions will not work without your location position. Please make sure you have allowed location tracking on this site. Click on the location icon placed on the right inside the chrome web address bar => Clear tracking setting => Refresh page > Allow tracking.\")');\n                    }\n                }\n            );\n        }\n\n        globalNav.children().first().before(stravaMenuHtml);\n\n        // $.fancybox('<div><h1>Modal example :)</h1><p>Remove this by searching the pattern \"5s874d45gfds4ds7s7dsdsq87a7q4s7f7d8ds7f\" in code</p></div>');\n    },\n};\n","markers":{"markers":{"1":{"id":1,"range":[[21,21],[21,21]],"tailed":false,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":8,"goalScreenRange":null},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[{"patches":[{"id":1,"oldParams":{"range":[[27,66],[27,71]],"tailed":true},"newParams":{"range":[[27,71],[27,71]],"tailed":false},"deserializer":"MarkerPatch"},{"oldRange":[[27,66],[27,71]],"newRange":[[27,66],[27,67]],"oldText":"white","newText":"t","normalizeLineEndings":true,"deserializer":"BufferPatch"},{"oldRange":[[27,67],[27,67]],"newRange":[[27,67],[27,68]],"oldText":"","newText":"r","normalizeLineEndings":true,"deserializer":"BufferPatch"},{"oldRange":[[27,68],[27,68]],"newRange":[[27,68],[27,69]],"oldText":"","newText":"a","normalizeLineEndings":true,"deserializer":"BufferPatch"},{"oldRange":[[27,69],[27,69]],"newRange":[[27,69],[27,70]],"oldText":"","newText":"n","normalizeLineEndings":true,"deserializer":"BufferPatch"},{"oldRange":[[27,70],[27,70]],"newRange":[[27,70],[27,71]],"oldText":"","newText":"s","normalizeLineEndings":true,"deserializer":"BufferPatch"}],"oldMarkersSnapshot":{"1":{"range":[[27,66],[27,71]],"valid":true}},"deserializer":"Transaction"},{"patches":[{"oldRange":[[27,71],[27,71]],"newRange":[[27,71],[27,72]],"oldText":"","newText":"p","normalizeLineEndings":true,"oldMarkersSnapshot":{"2":{"range":[[27,0],[27,115]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[27,72],[27,72]],"newRange":[[27,72],[27,73]],"oldText":"","newText":"a","normalizeLineEndings":true,"oldMarkersSnapshot":{"2":{"range":[[27,0],[27,116]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[27,73],[27,73]],"newRange":[[27,73],[27,74]],"oldText":"","newText":"r","normalizeLineEndings":true,"oldMarkersSnapshot":{"2":{"range":[[27,0],[27,117]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[27,74],[27,74]],"newRange":[[27,74],[27,75]],"oldText":"","newText":"e","normalizeLineEndings":true,"oldMarkersSnapshot":{"2":{"range":[[27,0],[27,118]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[27,75],[27,75]],"newRange":[[27,75],[27,76]],"oldText":"","newText":"n","normalizeLineEndings":true,"oldMarkersSnapshot":{"2":{"range":[[27,0],[27,119]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[27,76],[27,76]],"newRange":[[27,76],[27,77]],"oldText":"","newText":"t","normalizeLineEndings":true,"oldMarkersSnapshot":{"2":{"range":[[27,0],[27,120]],"valid":true}},"deserializer":"BufferPatch"}],"oldMarkersSnapshot":{"1":{"range":[[27,71],[27,71]],"valid":true},"2":{"range":[[27,0],[27,115]],"valid":true}},"deserializer":"Transaction"}],"redoStack":[],"deserializer":"History","version":1},"encoding":"utf8","filePath":"/Users/lildude/Development/stravistix/hook/extension/js/modifiers/MenuModifier.js","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"df6e560437ec7a31d6f5481c6abc8f1ba3184a95","deserializer":"TextBuffer"}],"deserializer":"Project"},"workspace":{"paneContainer":{"root":{"id":3,"items":[{"id":8,"softTabs":true,"displayBuffer":{"id":9,"softWrapped":true,"editorWidthInChars":null,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/lildude/Development/stravistix/hook/extension/js/modifiers/MenuModifier.js","invisibles":{"eol":"¬","space":"·","tab":"»","cr":"¤"},"deserializer":"TokenizedBuffer"},"invisibles":{"eol":"¬","space":"·","tab":"»","cr":"¤"},"deserializer":"DisplayBuffer"},"deserializer":"TextEditor"}],"activeItemURI":"/Users/lildude/Development/stravistix/hook/extension/js/modifiers/MenuModifier.js","focused":true,"deserializer":"Pane"},"activePaneId":3,"deserializer":"PaneContainer","version":1},"fullScreen":false,"packagesWithActiveGrammars":["language-javascript","language-hyperlink","language-todo"],"deserializer":"Workspace"},"packageStates":{"metrics":{"sessionLength":163141735},"fuzzy-finder":{"/Users/lildude/Development/stravistix/hook/extension/js/modifiers/MenuModifier.js":1431438173977},"tree-view":{"directoryExpansionStates":{"/Users/lildude/Development/stravistix":{"isExpanded":true,"entries":{".git":{"isExpanded":false,"entries":{}},"hook":{"isExpanded":true,"entries":{"extension":{"isExpanded":false,"entries":{}},"resources":{"isExpanded":false,"entries":{}}}}}}},"selectedPath":"/Users/lildude/Development/stravistix/hook/extension","hasFocus":false,"attached":true,"scrollLeft":0,"scrollTop":0,"width":200}}}