#!/bin/sh
#
# dot
#
# `dot` handles installation, updates, things like that. Run it periodically
# to make sure you're on the latest and greatest.
export ZSH=$HOME/.dotfiles
source $ZSH/bin/lib.sh

if [ "$(uname -s)" = "Darwin" ]; then
  # Install homebrew if not installed
  $ZSH/homebrew/install.sh 2>&1

  # Update homebrew
  brew update && success "Brew formulae updated" || fail "Brew formulae updated"

  # Upgrade homebrew pkgs
  if [ $(brew outdated | wc -l) -gt 0 ]; then
    brew upgrade && success "Upgraded brew packages" || fail "Upgrade brew packages"
  fi

  # Clean up
  if [ $(brew cleanup -n 2> /dev/null | wc -l) -gt 0 ]; then
    brew cleanup && success "Brew cleaned up" || fail "Brew clean up"
  fi
fi

# Install software
info "$ZSH/script/install"
$ZSH/script/install

if [ "$(uname -s)" = "Darwin" ]; then
  # Set OS X defaults
  info "Setting OSX defaults"
  $ZSH/osx/set-defaults.sh
fi

# Update list of Atom packages
if [ $(which apm) ]; then
  info "Updating Atom package list"
  apm list --installed --bare > ~/.atom/package-list.txt
fi
